(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     16168,        352]
NotebookOptionsPosition[     15237,        327]
NotebookOutlinePosition[     15604,        343]
CellTagsIndexPosition[     15561,        340]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["PrimiMaster", "Title",
 CellChangeTimes->{{3.772866992255372*^9, 3.7728670085361977`*^9}, {
  3.772876349534109*^9, 3.772876350372448*^9}},
 TextAlignment->Center,
 Background->RGBColor[
  1, 0.925, 0.925],ExpressionUUID->"bb8f9f6f-695a-43fa-86eb-3697c79a23c5"],

Cell[TextData[{
 "Runs both ",
 StyleBox["PrimiCosmo",
  FontWeight->"Bold"],
 " and ",
 StyleBox["PrimiNuc",
  FontWeight->"Bold"],
 " in one script, with example output."
}], "Text",
 CellDingbat->"\[FivePointedStar]",
 CellChangeTimes->{{3.772867030462081*^9, 3.77286708171566*^9}, {
  3.772867295829935*^9, 3.772867317788845*^9}, {3.772867786572171*^9, 
  3.772867794102057*^9}, {3.772867867136854*^9, 3.772867884228609*^9}, {
  3.77286792891523*^9, 3.7728679634007893`*^9}, {3.772876353595737*^9, 
  3.772876374730205*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"0905fc4c-fdb5-4ed6-b97d-e374b1a9d13f"],

Cell[BoxData[
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.772998387113439*^9, 3.772998387139292*^9}, 
   3.773041458208536*^9},
 CellLabel->"In[35]:=",ExpressionUUID->"1f069234-2a37-4c79-aae0-7da3f2879817"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->"In[36]:=",ExpressionUUID->"186e1636-6ccf-4640-ba44-c43963447257"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Quiet", "[", 
   RowBox[{"<<", "WIMP.m"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$EvolutionType", "=", " ", "\"\<WIMP\>\""}], ";"}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"TmgStart", " ", "=", " ", "30.1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CASE", " ", "=", " ", "\"\<EE\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SPIN", " ", "=", " ", "\"\<BE\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gDM", " ", "=", " ", "1."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Sigma]v", " ", "=", " ", "1."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BR", " ", "=", " ", "0."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Ombmin", "=", "0.015"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Ombmax", "=", "0.028"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MassDMArray", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"10", "^", "i"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"-", "1"}], ",", 
         RowBox[{"Log10", "[", "0.9", "]"}], ",", "0.1"}], "}"}]}], "]"}], 
     ",", 
     RowBox[{"Table", "[", 
      RowBox[{"i", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "14", ",", "0.3"}], "}"}]}], "]"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{"i", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "14", ",", "30", ",", "2"}], "}"}]}], "]"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"h2\[CapitalOmega]b0Array", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{"j", ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "Ombmin", ",", "Ombmax", ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Ombmax", "-", "Ombmin"}], ")"}], "/", 
        RowBox[{"(", "40", ")"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Abundances", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{"0.", ",", " ", 
     RowBox[{"{", 
      RowBox[{"k", ",", " ", "1", ",", " ", 
       RowBox[{"Length", "[", "MassDMArray", "]"}]}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"k", ",", " ", "1", ",", " ", 
       RowBox[{"Length", "[", "h2\[CapitalOmega]b0Array", "]"}]}], "}"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetSharedVariable", "[", 
   RowBox[{"h2\[CapitalOmega]b0Array", ",", "Abundances"}], "]"}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.773037741136126*^9, 3.77303774694035*^9}, 
   3.7730377774999228`*^9, 3.7730378123504953`*^9, {3.773037858573148*^9, 
   3.7730378738043613`*^9}, {3.773038561624305*^9, 3.773038594998309*^9}, 
   3.773041159547428*^9, {3.7730418658963346`*^9, 3.773041893013102*^9}, {
   3.773042008903427*^9, 3.77304201459763*^9}, {3.773042285223949*^9, 
   3.7730422857684107`*^9}, {3.773042416233992*^9, 3.7730424174543343`*^9}, {
   3.773044053999393*^9, 3.773044055043638*^9}, {3.773044755421389*^9, 
   3.7730447564523563`*^9}, {3.7730452679823112`*^9, 3.773045274918782*^9}, {
   3.773046095351137*^9, 3.7730461012145967`*^9}, 3.773047198357657*^9, {
   3.773047605359541*^9, 3.773047632288138*^9}, {3.7730476674266987`*^9, 
   3.77304770423071*^9}, {3.773073222887075*^9, 3.773073310262602*^9}, {
   3.773084401741679*^9, 3.773084405220908*^9}, {3.7730854771368093`*^9, 
   3.773085480360632*^9}, {3.773085904007494*^9, 3.7730859098949957`*^9}, 
   3.773089044723599*^9, {3.773126390720491*^9, 3.773126459711475*^9}, 
   3.773126502934272*^9, {3.773126738890881*^9, 3.7731267418181143`*^9}, 
   3.773127026087103*^9, {3.7731272336319113`*^9, 3.773127238563395*^9}, {
   3.773127426746709*^9, 3.773127454980919*^9}, {3.773135653935697*^9, 
   3.773135665548943*^9}, {3.7731429320937977`*^9, 3.7731429660177193`*^9}, {
   3.7731432831580544`*^9, 3.77314329108235*^9}, {3.773176490783133*^9, 
   3.773176491990926*^9}, {3.773176981741317*^9, 3.773176990044529*^9}, {
   3.7732052990420113`*^9, 3.773205299835224*^9}, {3.7732249102894783`*^9, 
   3.773224980121078*^9}, {3.773228412988062*^9, 3.773228420314541*^9}, {
   3.7732284703310213`*^9, 3.773228472756393*^9}, 3.773241859126625*^9, {
   3.773252138100041*^9, 3.77325215611946*^9}, {3.7732548082065897`*^9, 
   3.773254808443581*^9}, {3.7732549879280233`*^9, 3.773254989238863*^9}, 
   3.773255408901873*^9, {3.7733385496549797`*^9, 3.773338560854141*^9}, 
   3.7733485225687304`*^9, {3.773382640034721*^9, 3.773382648728702*^9}, {
   3.7733890561720552`*^9, 3.773389060636854*^9}, 3.773389096354398*^9, {
   3.7733891719550323`*^9, 3.773389204834228*^9}, 3.77338929725847*^9, {
   3.7734702498843813`*^9, 3.773470317546873*^9}, {3.773470534816675*^9, 
   3.773470535302236*^9}, {3.773470572511776*^9, 3.773470572642508*^9}, {
   3.773471049551985*^9, 3.773471050802548*^9}, 3.7734711952284803`*^9, {
   3.773471264395358*^9, 3.773471265559639*^9}, {3.773471683389998*^9, 
   3.773471683885913*^9}, {3.773473088698059*^9, 3.7734731383363237`*^9}, {
   3.773473329645651*^9, 3.7734733392172213`*^9}, {3.773476193719639*^9, 
   3.7734761979971647`*^9}, {3.773476469622995*^9, 3.7734764878415537`*^9}, {
   3.7735606901071568`*^9, 3.773560717224444*^9}, {3.773560788078515*^9, 
   3.773560792483314*^9}, {3.773563726807941*^9, 3.773563744591032*^9}, {
   3.773564012705903*^9, 
   3.773564019955041*^9}},ExpressionUUID->"603c8b82-feaf-495b-905b-\
1afb90ec9a01"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"LaunchKernels", "[", "6", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Do", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", "MDM", "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"MDM", " ", "=", " ", 
     RowBox[{"MassDMArray", "[", 
      RowBox[{"[", "l", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Quiet", "[", 
     RowBox[{"<<", "PrimiCosmo.m"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"DistributeDefinitions", "[", "\"\<Global`\>\"", "]"}], ";", 
    "\[IndentingNewLine]", "          ", 
    RowBox[{"ParallelDo", "[", "\[IndentingNewLine]", "            ", 
     RowBox[{
      RowBox[{
       RowBox[{"Clear", "[", "h2\[CapitalOmega]b0", "]"}], ";", 
       "\[IndentingNewLine]", "            ", 
       RowBox[{"h2\[CapitalOmega]b0", " ", "=", " ", 
        RowBox[{"h2\[CapitalOmega]b0Array", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "            ", 
       RowBox[{"Print", "[", 
        RowBox[{
        "\"\<\!\(\*SubscriptBox[\(M\), \(DM\)]\) = \>\"", ",", " ", "MDM", 
         ",", " ", "\"\< MeV & h2\[CapitalOmega]b0 = \>\"", ",", " ", 
         "h2\[CapitalOmega]b0"}], "]"}], ";", "\[IndentingNewLine]", 
       "            ", 
       RowBox[{"Quiet", "[", 
        RowBox[{"<<", "PrimiNuc.m"}], "]"}], ";", "\[IndentingNewLine]", 
       "            ", 
       RowBox[{
        RowBox[{"Abundances", "[", 
         RowBox[{"[", 
          RowBox[{"l", ",", "m"}], "]"}], "]"}], " ", "=", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"mgresultvec", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"Flatten", "[", 
            RowBox[{"List", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Yf", "[", "#", "]"}], "&"}], "/@", "ShortNames"}], 
             "]"}], "]"}]}], ",", "0.", ",", "0.", ",", "0."}], "]"}]}]}], 
      ",", "\[IndentingNewLine]", "            ", 
      RowBox[{"{", 
       RowBox[{"m", ",", "1", ",", 
        RowBox[{"Length", "[", "h2\[CapitalOmega]b0Array", "]"}]}], "}"}]}], 
     "\[IndentingNewLine]", "        ", "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"ForExport", " ", "=", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"MassDMArray", "[", 
            RowBox[{"[", "n", "]"}], "]"}], ",", 
           RowBox[{"h2\[CapitalOmega]b0Array", "[", 
            RowBox[{"[", "p", "]"}], "]"}], ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"Abundances", "[", 
             RowBox[{"[", 
              RowBox[{"n", ",", "p"}], "]"}], "]"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", 
           RowBox[{"Length", "[", "MassDMArray", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "1", ",", 
           RowBox[{"Length", "[", "h2\[CapitalOmega]b0Array", "]"}]}], 
          "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"ToString", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\<Abundances_Case=``_Stat=``_gDM=``_Sigmav=``_BR=``\>\"", ",", 
         "CASE", ",", "SPIN", ",", "gDM", ",", "\[Sigma]v", ",", "BR"}], 
        "]"}], "]"}], ",", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{
        "{", "\"\<M_DM     Omega_b h^2     Neff       n         p         D   \
      t         He3         a         Li7         Be7         chi2BBN         \
chi2CMB         chi2BBNCMB\>\"", "}"}], ",", "ForExport"}], "]"}], ",", 
      "\"\<Table\>\"", ",", 
      RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\< \>\""}]}], "]"}]}], 
   ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"l", ",", "1", ",", 
     RowBox[{"Length", "[", "MassDMArray", "]"}]}], "}"}]}], 
  "\[IndentingNewLine]", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.773036351825776*^9, 3.7730363602573757`*^9}, {
   3.773036398859774*^9, 3.7730364107614317`*^9}, {3.773036442207428*^9, 
   3.773036446083489*^9}, {3.773036563068316*^9, 3.773036567060087*^9}, {
   3.7730366771232443`*^9, 3.77303672214655*^9}, {3.773036776890224*^9, 
   3.773036799206058*^9}, {3.773036908295326*^9, 3.773037169991784*^9}, {
   3.773038307483905*^9, 3.773038398005987*^9}, {3.773040329227064*^9, 
   3.7730404317347927`*^9}, {3.773040475776506*^9, 3.7730405168061247`*^9}, 
   3.773041027388472*^9, 3.773041859142823*^9, 3.773042020339329*^9, {
   3.773042419804945*^9, 3.773042420626974*^9}, {3.773042885910324*^9, 
   3.77304290211768*^9}, 3.773042959436132*^9, {3.773043794641081*^9, 
   3.773043824432745*^9}, {3.773043876928866*^9, 3.773043886008224*^9}, {
   3.773043916666905*^9, 3.773043931316523*^9}, {3.773044041988459*^9, 
   3.7730440452350073`*^9}, {3.773044121295599*^9, 3.7730441280094357`*^9}, 
   3.773044194270048*^9, 3.77304437249613*^9, {3.773045170155048*^9, 
   3.773045188476981*^9}, {3.773046566993383*^9, 3.7730465678796253`*^9}, {
   3.773046966222124*^9, 3.7730469782201223`*^9}, {3.7730754846384974`*^9, 
   3.773075487286614*^9}, {3.773077450826282*^9, 3.773077452460569*^9}, {
   3.773079807503772*^9, 3.773079808497805*^9}, {3.773083820354938*^9, 
   3.77308383729852*^9}, {3.773084021174567*^9, 3.7730840226139307`*^9}, 
   3.773084519825738*^9, {3.773084688355722*^9, 3.7730847077066317`*^9}, {
   3.773084794780135*^9, 3.7730848241484537`*^9}, {3.773085030675465*^9, 
   3.773085031143523*^9}, {3.7730854639192057`*^9, 3.7730854732587852`*^9}, {
   3.773085669312203*^9, 3.773085679962038*^9}, {3.773126491641657*^9, 
   3.773126505442325*^9}, 3.773126748089201*^9, {3.773126923223302*^9, 
   3.77312702478111*^9}, {3.773127092698674*^9, 3.7731270955662613`*^9}, 
   3.773127138593122*^9, {3.7731272253151693`*^9, 3.773127228507683*^9}, {
   3.773127263933095*^9, 3.773127268416127*^9}, 3.773127500146813*^9, 
   3.773136999358046*^9, {3.773142976662878*^9, 3.773142979530427*^9}, 
   3.773144707696*^9, {3.773145070323205*^9, 3.7731450711653976`*^9}, 
   3.773176505801058*^9, {3.773176744922757*^9, 3.773176789662396*^9}, 
   3.773176970407001*^9, {3.773177220276993*^9, 3.773177222954049*^9}, 
   3.773254982653537*^9, {3.7732550948353558`*^9, 3.773255095009276*^9}, {
   3.773255377529828*^9, 3.773255381882882*^9}, 3.773255432626111*^9, {
   3.773260974394835*^9, 3.773260976755454*^9}, {3.773338565911393*^9, 
   3.77333859048181*^9}, {3.773389105210682*^9, 3.773389105302868*^9}, 
   3.773389466877198*^9, {3.773389595456379*^9, 3.7733895956224613`*^9}, {
   3.773470324467701*^9, 3.773470358416016*^9}, {3.77347149296805*^9, 
   3.773471563867128*^9}, {3.773471606117017*^9, 3.7734716932668467`*^9}, {
   3.773471751764101*^9, 3.773471755692582*^9}, {3.773471995237749*^9, 
   3.773471998703713*^9}, 3.773472031772108*^9, {3.7734721544628057`*^9, 
   3.773472154690431*^9}, {3.7734730494368277`*^9, 3.773473084530006*^9}, 
   3.773473224503561*^9, 3.7734733258225613`*^9, {3.773473367774891*^9, 
   3.7734733690942917`*^9}, 3.77347594692443*^9, 3.773476038633339*^9, {
   3.773476206231801*^9, 3.773476207962859*^9}, {3.7734764056284313`*^9, 
   3.773476406060309*^9}, {3.773560696751495*^9, 3.7735607819440613`*^9}, {
   3.773560950043638*^9, 3.773560951316975*^9}, 3.773561014607428*^9, {
   3.7735611160899677`*^9, 3.773561172288447*^9}, {3.773563709998475*^9, 
   3.773563715603544*^9}, 3.773563752462379*^9, {3.773563797170104*^9, 
   3.773563838719872*^9}, 
   3.7735640074391403`*^9},ExpressionUUID->"0150ca4f-dd75-4f24-a0c3-\
5af7722711ba"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{3090, 1689},
WindowMargins->{{0, Automatic}, {0, Automatic}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 267, 5, 229, "Title",ExpressionUUID->"bb8f9f6f-695a-43fa-86eb-3697c79a23c5"],
Cell[850, 29, 624, 16, 103, "Text",ExpressionUUID->"0905fc4c-fdb5-4ed6-b97d-e374b1a9d13f"],
Cell[1477, 47, 274, 5, 126, "Input",ExpressionUUID->"1f069234-2a37-4c79-aae0-7da3f2879817",
 InitializationCell->True],
Cell[1754, 54, 229, 5, 126, "Input",ExpressionUUID->"186e1636-6ccf-4640-ba44-c43963447257",
 InitializationCell->True],
Cell[1986, 61, 5448, 112, 707, "Input",ExpressionUUID->"603c8b82-feaf-495b-905b-1afb90ec9a01",
 InitializationCell->True],
Cell[7437, 175, 7784, 149, 1177, "Input",ExpressionUUID->"0150ca4f-dd75-4f24-a0c3-5af7722711ba",
 InitializationCell->True]
}, Open  ]]
}
]
*)

